<div class="flex flex-col w-full items-center justify-center mt-4">
  <div class="min-w-128">
    <h1 class="text-2xl font-bold mb-4">{{ configurationId() ? 'Edit' : 'Create' }} Import
      Configuration</h1>

    <messages-showcase [messages]="messages()"/>

    <div
      *ngIf="dataTypes.hasValue()"
      class="flex flex-col gap-4"
      [formGroup]="form"
    >
      <div class="flex flex-row gap-4">
        <div class="flex flex-col w-full">
          <label
            for="name"
            class="block text-sm font-medium"
          >Name</label>

          <input
            formControlName="name"
            pInputText
            type="text"
            id="name"
            class="mt-1 block w-full"
          />

          @if (getErrorMessage("name"); as error) {
            <div class="text-xs text-red-500 mt-1">{{ error }}</div>
          }
        </div>

        <div
          *ngIf="!configurationId()"
          class="flex flex-col w-full"
        >
          <label
            for="dataTypeId"
            class="block text-sm font-medium"
          >Data Type</label>

          <p-select
            formControlName="dataTypeId"
            [options]="dataTypes.value()"
            optionLabel="name"
            optionValue="id"
            placeholder="Select a data type"
            appendTo="body"
            styleClass="w-full"
            class="mt-1"
            (onChange)="changeFormFields($event.value)"
          />

          @if (getErrorMessage("dataType"); as error) {
            <div class="text-xs text-red-500 mt-1">{{ error }}</div>
          }
        </div>
      </div>

      <div class="flex flex-col">
        <label
          for="fields"
          class="block text-sm font-medium"
        >Fields</label>

        <p-table
          styleClass="w-full mt-2 dark:bg-primary-950! bg-primary-50!"
          paginatorStyleClass="dark:bg-primary-950! bg-primary-50!"
          id="fields"
          formArrayName="fields"
          [value]="formFields().controls"
        >
          <ng-template #header>
            <tr>
              <th>Order</th>
              <th>Name</th>
              <th>Default Value</th>
              <th>Actions</th>
            </tr>
          </ng-template>

          <ng-template #body let-formField let-i="rowIndex">
            <tr [formGroup]="formField">
              <td>{{ i + 1 }}</td>
              <td>{{ getFieldName(i) }}</td>

              <td>
                @let fieldType = getFieldType(i);

                @if (fieldType === FieldType.Reference) {
                  <p-select
                    placeholder="Select a referenced entry"
                    [options]="getDataEntries(i)()"
                    optionLabel="label"
                    optionValue="id"
                    appendTo="body"
                    formControlName="defaultValue"
                    class="w-full"
                  />
                } @else {
                  <data-type-entry-field-input
                    formControlName="defaultValue"
                    [type]="fieldType"
                  />
                }
              </td>

              <td>
                <p-button
                  icon="pi pi-chevron-up"
                  type="button"
                  variant="text"
                  (onClick)="moveField(i,  -1)"
                />

                <p-button
                  icon="pi pi-chevron-down"
                  type="button"
                  variant="text"
                  (onClick)="moveField(i,  1)"
                />
              </td>
            </tr>
          </ng-template>
        </p-table>
      </div>
    </div>

    <div class="flex justify-end mt-4">
      <p-button
        [label]="configuration.hasValue() ? 'Save' : 'Create'"
        [disabled]="form.invalid || !form.dirty"
        (onClick)="save()"
        type="submit"
      />
    </div>
  </div>
</div>
