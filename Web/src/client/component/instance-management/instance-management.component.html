<p-dialog
  header="Instance Management"
  closeOnEscape="true"
  modal="true"
  styleClass="min-w-128"
  closable="true"
  [(visible)]="isShown"
  (onHide)="hide()"
  (close)="hide()"
>
  <div class="min-w-128">
    <messages-showcase [messages]="messages()"/>

    <form class="grid grid-cols-1 gap-4" [formGroup]="form">
      <div>
        <label for="name" class="block text-sm font-medium">Name</label>
        <input formControlName="name" pInputText type="text" id="name" class="mt-1 block w-full"/>
        <form-input-error [control]="form.controls.name"/>
      </div>

      <div>
        <label for="description" class="block text-sm font-medium">Description</label>
        <textarea formControlName="description" pTextarea id="description" class="mt-1 p-2 block w-full"></textarea>
        <form-input-error [control]="form.controls.description"/>
      </div>

      <div>
        <label for="users" class="block text-l font-bold">Users</label>
        <p-table [value]="formUsers().controls">
          <ng-template pTemplate="header">
            <tr>
              <th>Email</th>
              <th>Name</th>
              <th>Actions</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-user let-i="rowIndex">
            <tr>
              <td>{{ user.value.email }}</td>
              <td>{{ user.value.name }}</td>
              <td>
                <p-button [disabled]="user.value.isOwnerOrSelf" variant="text" icon="pi pi-trash" (onClick)="removeUser(i)"/>
              </td>
            </tr>
          </ng-template>
        </p-table>
      </div>

      <messages-showcase [messages]="messagesUserMetas()"/>

      <form [formGroup]="formUser" class="flex flex-row gap-x-4 mt-1 max-w-96">
        <div class="flex flex-col">
          <input formControlName="email" placeholder="Enter email..." pInputText type="email" id="email"
                 class="mt-1 block w-full"/>
          <form-input-error [control]="formUser.controls.email" [customErrorMessages]="customErrorMessages"/>
        </div>
        <p-button class="mt-1" label="Add user" [disabled]="formUser.invalid" (onClick)="addUser()"/>
      </form>
    </form>

    <div class="flex justify-end mt-4">
      <p-button [label]="instance() === undefined ? 'Create' : 'Save'" [disabled]="form.invalid || !form.dirty" (onClick)="save()"
                type="submit"/>
    </div>
  </div>
</p-dialog>
